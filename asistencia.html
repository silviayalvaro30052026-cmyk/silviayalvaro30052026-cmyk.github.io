<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Asistencia ‚Äî Silvia & √Ålvaro</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Confirma tu asistencia a la boda de Silvia & √Ålvaro." />

  <!-- Misma fuente que el resto del sitio -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&display=swap" rel="stylesheet" />

  <link rel="stylesheet" href="styles.css" />
  <style>
    /* Estilos locales que complementan styles.css */
    .rsvp-form { display:block; width:100%; }
    .form-row { display:flex; gap:1rem; margin:0.5rem 0 1rem; align-items:center; flex-wrap:wrap; }
    .form-row .field { flex:1 1 220px; min-width:180px; }
    label { display:block; font-weight:600; margin-bottom:0.35rem; color: inherit; font-family: inherit; }
    input[type="text"], textarea {
      width:100%;
      padding:0.6rem 0.75rem;
      border-radius:8px;
      border:1px solid rgba(0,0,0,0.12);
      background: rgba(255,255,255,0.96);
      font-family: inherit;
      font-size: 1rem;
      color: inherit;
      box-sizing: border-box;
    }
    textarea { min-height: 100px; resize: vertical; }
    fieldset { border: 0; padding: 0; margin: 0 0 1rem 0; }
    .choices, .radio-group { display:flex; gap:0.6rem; flex-wrap:wrap; align-items:center; }
    .choice-label {
      display:inline-flex; align-items:center; gap:0.45rem; padding:0.35rem 0.6rem;
      border-radius:8px; background: rgba(255,255,255,0.72); cursor: pointer; font-weight:600; color: #0b3d2e;
      font-family: inherit;
    }
    input[type="radio"] { accent-color: var(--brand-green); }

    /* Lodging specific */
    #lodging-section { margin-top: 0.6rem; }
    .supplements { display:flex; gap:0.8rem; flex-wrap:wrap; margin-top:0.5rem; }
    .supplement-label { display:inline-flex; align-items:center; gap:0.45rem; padding:0.28rem 0.45rem; border-radius:8px; background: rgba(255,255,255,0.86); color: inherit; }

    /* Form actions: centrar bot√≥n y mensaje debajo */
    .form-actions {
      margin-top: 0.75rem;
      display:flex;
      flex-direction:column;
      gap:0.6rem;
      align-items:center;
      justify-content:center;
    }

    /* Mensaje de confirmaci√≥n sin caja, con animaci√≥n */
    .rsvp-message {
      opacity: 0;
      transform: translateY(10px);
      transition: opacity 420ms ease, transform 420ms cubic-bezier(.2,.9,.2,1);
      color: var(--brand-green-dark);
      font-weight:700;
      font-family: inherit;
      font-size: 1.05rem;
      text-align:center;
    }
    .rsvp-message.show { opacity: 1; transform: translateY(0); }

    .is-hidden { display:none !important; }

    @media (max-width:640px) {
      .form-row { gap:0.5rem; }
      .form-row .field { flex:1 1 100%; min-width:0; }
    }
  </style>
</head>
<body class="evento-page">

  <!-- Navegaci√≥n -->
  <nav class="top-nav" role="navigation" aria-label="Navegaci√≥n de la boda">
    <ul class="nav-list" role="menubar" aria-label="Secciones">
      <li role="none"><a role="menuitem" class="nav-btn" href="index.html">Inicio</a></li>
      <li role="none"><a role="menuitem" class="nav-btn" href="evento.html">Evento</a></li>
      <li role="none"><span class="nav-current" aria-current="page">Asistencia</span></li>
      <li role="none"><a role="menuitem" class="nav-btn" href="alojamiento.html">Alojamiento</a></li>
      <li role="none"><a role="menuitem" class="nav-btn" href="regalo.html">Regalo</a></li>
    </ul>
  </nav>

  <main id="main" class="section" role="main">
    <h1>Confirmar asistencia</h1>

    <section class="card" aria-labelledby="asistencia-heading">
      <h2 id="asistencia-heading" style="margin-top:0;">Formulario de asistencia</h2>

      <!-- FORM: enviado a Formspree v√≠a fetch para mostrar mensaje personalizado -->
      <form id="rsvpForm" class="rsvp-form" method="POST" action="https://formspree.io/f/mdaankgw" novalidate>
        <!-- Hidden fields -->
        <input type="hidden" name="_subject" value="RSVP Silvia & √Ålvaro">
        <input type="text" name="_gotcha" style="display:none" aria-hidden="true">

        <!-- 1. ¬øAsistir√°s? (solo S√≠ / No) -->
        <fieldset aria-labelledby="asistiras-legend">
          <legend id="asistiras-legend" style="font-weight:700;margin-bottom:0.5rem;">¬øAsistir√°s a la boda?</legend>
          <div class="choices" role="radiogroup" aria-labelledby="asistiras-legend">
            <label class="choice-label">
              <input type="radio" name="attendance" value="si"> S√≠
            </label>

            <label class="choice-label">
              <input type="radio" name="attendance" value="no"> No
            </label>
          </div>
        </fieldset>

        <!-- 2. ¬øQui√©n eres? -->
        <fieldset>
          <legend style="font-weight:700;margin-bottom:0.5rem;">¬øQui√©n eres?</legend>
          <div class="form-row">
            <div class="field">
              <label for="firstName">Nombre</label>
              <input id="firstName" name="firstName" type="text" placeholder="Nombre" required>
            </div>
            <div class="field">
              <label for="lastName">Apellido</label>
              <input id="lastName" name="lastName" type="text" placeholder="Apellido" required>
            </div>
          </div>
        </fieldset>

        <!-- 3. Dieta (radios: sin preselecci√≥n) -->
        <fieldset>
          <legend style="font-weight:700;margin-bottom:0.5rem;">¬øSigues alguna dieta especial?</legend>
          <div class="radio-group" role="radiogroup" aria-labelledby="dieta-legend" id="dieta-legend">
            <label class="choice-label"><input type="radio" name="diet" value="no"> No</label>
            <label class="choice-label"><input type="radio" name="diet" value="vegetariana"> Vegetariana</label>
            <label class="choice-label"><input type="radio" name="diet" value="vegetariana-pescado"> Vegetariana (como pescado)</label>
            <label class="choice-label"><input type="radio" name="diet" value="vegana"> Vegana</label>
          </div>
        </fieldset>

        <!-- 4. Intolerancias / alergias -->
        <fieldset>
          <legend style="font-weight:700;margin-bottom:0.5rem;">¬øAlguna intolerancia o alergia?</legend>
          <div class="form-row">
            <div class="field" style="flex:1 1 100%;">
              <label for="allergies" class="form-note">Indica aqu√≠ si tienes alguna intolerancia o alergia</label>
              <textarea id="allergies" name="allergies" placeholder="Escribe aqu√≠ intolerancias o alergias‚Ä¶"></textarea>
            </div>
          </div>
        </fieldset>

        <!-- 5. Preboda -->
        <fieldset aria-labelledby="preboda-legend">
          <legend id="preboda-legend" style="font-weight:700;margin-bottom:0.5rem;">¬øVendr√°s a la preboda?</legend>
          <div class="choices" role="radiogroup" aria-labelledby="preboda-legend">
            <label class="choice-label"><input type="radio" name="preboda" value="si"> S√≠</label>
            <label class="choice-label"><input type="radio" name="preboda" value="no"> No</label>
          </div>
        </fieldset>

        <!-- 6. Alojamiento (AHORA: pregunta siempre visible; no opciones marcadas por defecto) -->
        <fieldset id="lodging-section" aria-labelledby="lodging-legend">
          <legend id="lodging-legend" style="font-weight:700;margin-bottom:0.5rem;">¬øTe alojar√°s en el hotel reservado?</legend>

          <p style="margin-top:0; margin-bottom:0.6rem;">
            Por comodidad, el hotel estar√° reservado para los invitados. Indica aqu√≠ si os quedar√©is y la opci√≥n preferida.
          </p>

          <!-- willStay always visible; no pre-checked options -->
          <div style="margin-bottom:0.6rem;">
            <div class="choices" role="radiogroup" aria-label="¬øTe alojar√°s en el hotel?">
              <label class="choice-label"><input type="radio" name="willStay" value="si"> S√≠</label>
              <label class="choice-label"><input type="radio" name="willStay" value="no"> No</label>
            </div>
          </div>

          <!-- Room options: appear only when willStay = si; no preselection -->
          <div id="roomOptions" class="is-hidden" aria-hidden="true" style="margin-top:0.6rem;">
            <div style="margin-bottom:0.6rem;">
              <div style="font-weight:700; margin-bottom:0.35rem;">Opciones disponibles (selecciona una)</div>

              <div class="choices" style="flex-direction:column; align-items:flex-start;">
                <label class="choice-label" style="display:flex;align-items:flex-start;gap:0.8rem;">
                  <input type="radio" name="roomChoice" value="double_2n">
                  <div>
                    <strong>Habitaci√≥n doble ‚Äî 2 noches (viernes a domingo)</strong><br>
                    Precio total: 187 ‚Ç¨ ‚Äî Precio por persona y noche: 46,75 ‚Ç¨
                  </div>
                </label>

                <label class="choice-label" style="display:flex;align-items:flex-start;gap:0.8rem;">
                  <input type="radio" name="roomChoice" value="double_1n">
                  <div>
                    <strong>Habitaci√≥n doble ‚Äî 1 noche</strong><br>
                    Precio total: 95,50 ‚Ç¨ ‚Äî Precio por persona y noche: 47,75 ‚Ç¨
                  </div>
                </label>

                <label class="choice-label" style="display:flex;align-items:flex-start;gap:0.8rem;">
                  <input type="radio" name="roomChoice" value="triple_2n">
                  <div>
                    <strong>Habitaci√≥n triple ‚Äî 2 noches (viernes a domingo)</strong><br>
                    Precio total: 248 ‚Ç¨ ‚Äî Precio por persona y noche: 41,33 ‚Ç¨
                  </div>
                </label>
              </div>
            </div>

            <div style="margin-top:0.45rem;">
              <div style="font-weight:700; margin-bottom:0.35rem;">Suplementos opcionales (por habitaci√≥n y noche)</div>
              <div class="supplements">
                <label class="supplement-label"><input type="checkbox" name="supplement_junior" value="junior"> Junior Suite ‚Üí + 32 ‚Ç¨ / noche</label>
                <label class="supplement-label"><input type="checkbox" name="supplement_suite" value="suite"> Suite ‚Üí + 42 ‚Ç¨ / noche</label>
              </div>
            </div>

            <!-- Nueva caja: con qui√©n te vas a alojar (aparece bajo opciones cuando willStay = si) -->
            <div style="margin-top:0.6rem;">
              <label for="roomWith" style="font-weight:700; display:block; margin-bottom:0.35rem;">¬øCon qui√©n te alojar√°s? (nombres)</label>
              <input id="roomWith" name="roomWith" type="text" placeholder="Nombre(s) de la(s) persona(s) con las que te alojas">
            </div>

            <div style="margin-top:0.6rem;">
              <label for="lodgingComments" style="font-weight:700; display:block; margin-bottom:0.3rem;">üìù Comentarios o necesidades especiales (cuna, dudas, etc)</label>
              <textarea id="lodgingComments" name="lodgingComments" placeholder="Escribe aqu√≠‚Ä¶"></textarea>
            </div>
          </div>

          <!-- Other lodging input: appears when willStay = no -->
          <div id="otherLodging" class="is-hidden" aria-hidden="true" style="margin-top:0.6rem;">
            <label for="otherAccommodation" style="font-weight:700; display:block; margin-bottom:0.35rem;">¬øD√≥nde te alojar√°s? (hotel / casa rural / hostal)</label>
            <input id="otherAccommodation" name="otherAccommodation" type="text" placeholder="Nombre y direcci√≥n del alojamiento">
          </div>
        </fieldset>

        <!-- 7. Algo m√°s que debamos saber (general) -->
        <fieldset>
          <legend style="font-weight:700;margin-bottom:0.5rem;">¬øAlgo m√°s que debamos saber?</legend>
          <div class="form-row">
            <div class="field" style="flex:1 1 100%;">
              <label for="notes" class="form-note">Comentarios adicionales (transporte, horarios, etc.)</label>
              <textarea id="notes" name="notes" placeholder="Escribe aqu√≠‚Ä¶"></textarea>
            </div>
          </div>
        </fieldset>

        <div class="form-actions">
          <!-- Bot√≥n centrado con solo "Enviar" -->
          <button type="submit" class="btn-primary" aria-label="Enviar">Enviar</button>

          <!-- Mensaje aparecer√° aqu√≠ debajo del bot√≥n con efecto -->
          <div id="formStatus" role="status" aria-live="polite"></div>
        </div>
      </form>
    </section>
  </main>

  <footer class="footer" role="contentinfo">√Ålvaro & Silvia ¬∑ 30/05/2026</footer>

  <script>
    (function () {
      const form = document.getElementById('rsvpForm');
      const statusEl = document.getElementById('formStatus');
      const submitBtn = form.querySelector('button[type="submit"]');

      const willStayRadios = Array.from(document.querySelectorAll('input[name="willStay"]'));
      const roomOptions = document.getElementById('roomOptions');
      const otherLodging = document.getElementById('otherLodging');
      const roomChoiceInputs = () => Array.from(document.querySelectorAll('input[name="roomChoice"]'));

      function updateLodgingSubfields() {
        const will = document.querySelector('input[name="willStay"]:checked')?.value;
        if (will === 'si') {
          // show room options, hide "other lodging"
          roomOptions.classList.remove('is-hidden');
          roomOptions.setAttribute('aria-hidden', 'false');
          otherLodging.classList.add('is-hidden');
          otherLodging.setAttribute('aria-hidden', 'true');
          // make roomChoice required when visible
          roomChoiceInputs().forEach(i => i.required = true);
        } else if (will === 'no') {
          // show "other lodging" input, hide room options
          otherLodging.classList.remove('is-hidden');
          otherLodging.setAttribute('aria-hidden', 'false');
          roomOptions.classList.add('is-hidden');
          roomOptions.setAttribute('aria-hidden', 'true');
          // remove required from roomChoice and clear selection
          roomChoiceInputs().forEach(i => { i.required = false; i.checked = false; });
        } else {
          // neither selected: hide both
          roomOptions.classList.add('is-hidden');
          roomOptions.setAttribute('aria-hidden', 'true');
          otherLodging.classList.add('is-hidden');
          otherLodging.setAttribute('aria-hidden', 'true');
          roomChoiceInputs().forEach(i => { i.required = false; i.checked = false; });
        }
      }

      // Add listeners to willStay radios
      willStayRadios.forEach(r => r.addEventListener('change', updateLodgingSubfields));

      // Initialize visibility on load (no preselected options => both hidden)
      updateLodgingSubfields();

      // Submit handler using fetch to Formspree for custom confirmation
      form.addEventListener('submit', async function (e) {
        e.preventDefault();
        statusEl.innerHTML = '';

        // native validation
        if (!form.checkValidity()) {
          form.reportValidity();
          return;
        }

        const action = form.action;
        const formData = new FormData(form);

        try {
          submitBtn.disabled = true;
          submitBtn.setAttribute('aria-busy', 'true');

          const resp = await fetch(action, {
            method: 'POST',
            body: formData,
            headers: { 'Accept': 'application/json' }
          });

          if (resp.ok) {
            // Show success message under button (animated)
            statusEl.innerHTML = '<div class="rsvp-message" id="rsvpMessage">Gracias, nos vemos el 30 de Mayo.</div>';
            const msg = document.getElementById('rsvpMessage');
            requestAnimationFrame(() => requestAnimationFrame(() => msg.classList.add('show')));
            form.reset();
            // After reset, hide both lodging subfields
            updateLodgingSubfields();
            submitBtn.disabled = false;
            submitBtn.removeAttribute('aria-busy');
          } else {
            const data = await resp.json().catch(()=>null);
            let msg = 'Error al enviar. Por favor int√©ntalo de nuevo.';
            if (data && data.error) msg = data.error;
            statusEl.innerHTML = '<div class="form-note" style="color: #b33;">'+msg+'</div>';
            submitBtn.disabled = false;
            submitBtn.removeAttribute('aria-busy');
          }
        } catch (err) {
          statusEl.innerHTML = '<div class="form-note" style="color: #b33;">Error de conexi√≥n. Intenta de nuevo m√°s tarde.</div>';
          submitBtn.disabled = false;
          submitBtn.removeAttribute('aria-busy');
        }
      });
    })();
  </script>
</body>
</html>
