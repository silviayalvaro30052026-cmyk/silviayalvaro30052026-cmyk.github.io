<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Asistencia ‚Äî Silvia & √Ålvaro</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Confirma tu asistencia a la boda de Silvia & √Ålvaro." />

  <!-- Misma fuente que el resto del sitio -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&display=swap" rel="stylesheet" />

  <link rel="stylesheet" href="styles.css" />
  <style>
    /* Peque√±os estilos espec√≠ficos del formulario (complementan styles.css) */
    .rsvp-form { display:block; width:100%; }
    .form-row { display:flex; gap:1rem; margin:0.5rem 0 1rem; align-items:center; flex-wrap:wrap; }
    .form-row .field { flex:1 1 220px; min-width:180px; }
    label { display:block; font-weight:600; margin-bottom:0.35rem; color: inherit; font-family: inherit; }
    input[type="text"], textarea, select {
      width:100%;
      padding:0.6rem 0.75rem;
      border-radius:8px;
      border:1px solid rgba(0,0,0,0.12);
      background: rgba(255,255,255,0.96);
      font-family: inherit;
      font-size: 1rem;
      color: inherit;
      box-sizing: border-box;
    }
    textarea { min-height: 100px; resize: vertical; }
    fieldset { border: 0; padding: 0; margin: 0 0 1rem 0; }
    .choices, .radio-group { display:flex; gap:0.6rem; flex-wrap:wrap; align-items:center; }
    .choice-label {
      display:inline-flex; align-items:center; gap:0.45rem; padding:0.35rem 0.6rem;
      border-radius:8px; background: rgba(255,255,255,0.72); cursor: pointer; font-weight:600; color: #0b3d2e;
      font-family: inherit;
    }
    input[type="radio"] { accent-color: var(--brand-green); }

    /* Lodging specific */
    #lodging-section { margin-top: 0.2rem; }
    .supplements { display:flex; gap:0.8rem; flex-wrap:wrap; margin-top:0.5rem; }
    .supplement-label { display:inline-flex; align-items:center; gap:0.45rem; padding:0.28rem 0.45rem; border-radius:8px; background: rgba(255,255,255,0.86); color: inherit; }

    /* Form actions: centrar bot√≥n y mensaje debajo */
    .form-actions {
      margin-top: 0.75rem;
      display:flex;
      flex-direction:column;
      gap:0.6rem;
      align-items:center;
      justify-content:center;
    }

    /* Mensaje de confirmaci√≥n sin caja, con animaci√≥n */
    .rsvp-message {
      opacity: 0;
      transform: translateY(10px);
      transition: opacity 420ms ease, transform 420ms cubic-bezier(.2,.9,.2,1);
      color: var(--brand-green-dark);
      font-weight:700;
      font-family: inherit;
      font-size: 1.05rem;
      text-align:center;
    }
    .rsvp-message.show { opacity: 1; transform: translateY(0); }

    .is-hidden { display:none !important; }
    @media (max-width:640px) {
      .form-row { gap:0.5rem; }
      .form-row .field { flex:1 1 100%; min-width:0; }
    }
  </style>
</head>
<body class="evento-page">

  <!-- Navegaci√≥n en el flujo de la p√°gina (no fija) -->
  <nav class="top-nav" role="navigation" aria-label="Navegaci√≥n de la boda">
    <ul class="nav-list" role="menubar" aria-label="Secciones">
      <li role="none"><a role="menuitem" class="nav-btn" href="index.html">Inicio</a></li>
      <li role="none"><a role="menuitem" class="nav-btn" href="evento.html">Evento</a></li>
      <li role="none"><span class="nav-current" aria-current="page">Asistencia</span></li>
      <li role="none"><a role="menuitem" class="nav-btn" href="alojamiento.html">Alojamiento</a></li>
      <li role="none"><a role="menuitem" class="nav-btn" href="regalo.html">Regalo</a></li>
    </ul>
  </nav>

  <main id="main" class="section" role="main">
    <h1>Confirmar asistencia</h1>

    <section class="card" aria-labelledby="asistencia-heading">
      <h2 id="asistencia-heading" style="margin-top:0;">Formulario de asistencia</h2>

      <!-- FORM: enviado a Formspree v√≠a fetch para mostrar mensaje personalizado -->
      <form id="rsvpForm" class="rsvp-form" method="POST" action="https://formspree.io/f/mdaankgw" novalidate>
        <!-- Hidden fields -->
        <input type="hidden" name="_subject" value="RSVP Silvia & √Ålvaro">
        <input type="text" name="_gotcha" style="display:none" aria-hidden="true">

        <!-- 1. ¬øAsistir√°s? (solo S√≠ / No) -->
        <fieldset aria-labelledby="asistiras-legend">
          <legend id="asistiras-legend" style="font-weight:700;margin-bottom:0.5rem;">¬øAsistir√°s a la boda?</legend>
          <div class="choices" role="radiogroup" aria-labelledby="asistiras-legend">
            <label class="choice-label">
              <input type="radio" name="attendance" value="si" required> S√≠
            </label>

            <label class="choice-label">
              <input type="radio" name="attendance" value="no"> No
            </label>
          </div>
        </fieldset>

        <!-- 2. ¬øQui√©n eres? -->
        <fieldset>
          <legend style="font-weight:700;margin-bottom:0.5rem;">¬øQui√©n eres?</legend>
          <div class="form-row">
            <div class="field">
              <label for="firstName">Nombre</label>
              <input id="firstName" name="firstName" type="text" placeholder="Nombre" required>
            </div>
            <div class="field">
              <label for="lastName">Apellido</label>
              <input id="lastName" name="lastName" type="text" placeholder="Apellido" required>
            </div>
          </div>
        </fieldset>

        <!-- 3. Dieta (radios: selecci√≥n √∫nica) -->
        <fieldset>
          <legend style="font-weight:700;margin-bottom:0.5rem;">¬øSigues alguna dieta especial?</legend>
          <div class="radio-group" role="radiogroup" aria-labelledby="dieta-legend" id="dieta-legend">
            <label class="choice-label">
              <input type="radio" name="diet" value="no" checked> No
            </label>
            <label class="choice-label">
              <input type="radio" name="diet" value="vegetariana"> Vegetariana
            </label>
            <label class="choice-label">
              <input type="radio" name="diet" value="vegetariana-pescado"> Vegetariana (como pescado)
            </label>
            <label class="choice-label">
              <input type="radio" name="diet" value="vegana"> Vegana
            </label>
          </div>
        </fieldset>

        <!-- 4. Intolerancias / alergias -->
        <fieldset>
          <legend style="font-weight:700;margin-bottom:0.5rem;">¬øAlguna intolerancia o alergia?</legend>
          <div class="form-row">
            <div class="field" style="flex:1 1 100%;">
              <label for="allergies" class="form-note">Indica aqu√≠ si tienes alguna intolerancia o alergia</label>
              <textarea id="allergies" name="allergies" placeholder="Escribe aqu√≠ intolerancias o alergias‚Ä¶"></textarea>
            </div>
          </div>
        </fieldset>

        <!-- 5. Preboda -->
        <fieldset aria-labelledby="preboda-legend">
          <legend id="preboda-legend" style="font-weight:700;margin-bottom:0.5rem;">¬øVendr√°s a la preboda?</legend>
          <div class="choices" role="radiogroup" aria-labelledby="preboda-legend">
            <label class="choice-label"><input type="radio" name="preboda" value="si"> S√≠</label>
            <label class="choice-label"><input type="radio" name="preboda" value="no" checked> No</label>
          </div>
        </fieldset>

        <!-- 6. Alojamiento (integrado desde alojamiento.html) -->
        <fieldset id="lodging-section" class="is-hidden" aria-hidden="true">
          <legend style="font-weight:700;margin-bottom:0.5rem;">Alojamiento (opcional ‚Äî hotel reservado)</legend>

          <p style="margin-top:0; margin-bottom:0.6rem;">
            Por comodidad, el hotel estar√° reservado para los invitados. Si os interesa alojaros all√≠, indicadlo aqu√≠ y la opci√≥n que prefer√≠s.
          </p>

          <!-- ¬øTe alojar√°s en el hotel? -->
          <div style="margin-bottom:0.6rem;">
            <div style="font-weight:700; margin-bottom:0.35rem;">¬øTe alojar√°s en el hotel?</div>
            <div class="choices">
              <label class="choice-label"><input type="radio" name="willStay" value="si"> S√≠</label>
              <label class="choice-label"><input type="radio" name="willStay" value="no" checked> No</label>
            </div>
          </div>

          <!-- Room options: shown only if willStay = si -->
          <div id="roomOptions" class="is-hidden" aria-hidden="true" style="margin-top:0.6rem;">
            <div style="margin-bottom:0.6rem;">
              <strong>Habitaci√≥n doble (2 personas)</strong>
              <div style="margin-top:0.45rem;">
                <div class="choices">
                  <label class="choice-label"><input type="radio" name="roomType" value="double" checked> Habitaci√≥n doble</label>
                </div>

                <div style="margin-top:0.45rem;">
                  <div class="option-prices">
                    <div><strong>2 noches (viernes a domingo):</strong> 187 ‚Ç¨</div>
                    <div style="margin-top:0.25rem;"><strong>1 noche:</strong> 95,50 ‚Ç¨</div>
                  </div>

                  <div class="choices" style="margin-top:0.5rem;">
                    <label class="choice-label"><input type="radio" name="double_nights" value="2n" checked> 2 noches (viernes a domingo)</label>
                    <label class="choice-label"><input type="radio" name="double_nights" value="1n"> 1 noche</label>
                  </div>
                </div>
              </div>
            </div>

            <div style="margin-bottom:0.6rem;">
              <strong>Habitaci√≥n triple (3 personas)</strong>
              <div style="margin-top:0.45rem;">
                <div class="choices">
                  <label class="choice-label"><input type="radio" name="roomType" value="triple"> Habitaci√≥n triple</label>
                </div>

                <div style="margin-top:0.45rem;">
                  <div class="option-prices">
                    <div><strong>2 noches (viernes a domingo):</strong> 248 ‚Ç¨</div>
                  </div>

                  <div class="choices" style="margin-top:0.5rem;">
                    <label class="choice-label"><input type="radio" name="triple_nights" value="2n" checked> 2 noches (viernes a domingo)</label>
                  </div>
                </div>
              </div>
            </div>

            <div style="margin-top:0.4rem;">
              <div style="font-weight:700; margin-bottom:0.35rem;">Suplementos opcionales (por habitaci√≥n y noche)</div>
              <div class="supplements">
                <label class="supplement-label"><input type="checkbox" name="supplement_junior" value="junior"> Junior Suite ‚Üí + 32 ‚Ç¨ / noche</label>
                <label class="supplement-label"><input type="checkbox" name="supplement_suite" value="suite"> Suite ‚Üí + 42 ‚Ç¨ / noche</label>
              </div>
            </div>

            <div style="margin-top:0.6rem;">
              <label for="lodgingComments" style="font-weight:700; display:block; margin-bottom:0.3rem;">üìù Comentarios o necesidades especiales (cuna, dudas, etc)</label>
              <textarea id="lodgingComments" name="lodgingComments" placeholder="Escribe aqu√≠‚Ä¶"></textarea>
            </div>
          </div>
        </fieldset>

        <!-- 7. Algo m√°s que debamos saber (general) -->
        <fieldset>
          <legend style="font-weight:700;margin-bottom:0.5rem;">¬øAlgo m√°s que debamos saber?</legend>
          <div class="form-row">
            <div class="field" style="flex:1 1 100%;">
              <label for="notes" class="form-note">Comentarios adicionales (transporte, horarios, etc.)</label>
              <textarea id="notes" name="notes" placeholder="Escribe aqu√≠‚Ä¶"></textarea>
            </div>
          </div>
        </fieldset>

        <div class="form-actions">
          <!-- Bot√≥n centrado con solo "Enviar" -->
          <button type="submit" class="btn-primary" aria-label="Enviar">Enviar</button>

          <!-- Mensaje aparecer√° aqu√≠ debajo del bot√≥n con efecto -->
          <div id="formStatus" role="status" aria-live="polite"></div>
        </div>
      </form>
    </section>
  </main>

  <footer class="footer" role="contentinfo">√Ålvaro & Silvia ¬∑ 30/05/2026</footer>

  <script>
    (function () {
      // Form elements
      const form = document.getElementById('rsvpForm');
      const statusEl = document.getElementById('formStatus');
      const submitBtn = form.querySelector('button[type="submit"]');

      // Attendance & lodging visibility
      const attendanceRadios = Array.from(form.elements['attendance'] || []);
      const lodgingSection = document.getElementById('lodging-section');
      const willStayRadios = Array.from(form.elements['willStay'] || []);
      const roomOptions = document.getElementById('roomOptions');

      function updateLodgingVisibility() {
        const att = attendanceRadios.find(r => r.checked)?.value;
        if (att === 'si') {
          lodgingSection.classList.remove('is-hidden');
          lodgingSection.setAttribute('aria-hidden', 'false');
          // require willStay selection
          willStayRadios.forEach(r => r.required = true);
        } else {
          lodgingSection.classList.add('is-hidden');
          lodgingSection.setAttribute('aria-hidden', 'true');
          willStayRadios.forEach(r => r.required = false);
          // also hide room options
          hideRoomOptions();
        }
      }

      function showRoomOptions() {
        roomOptions.classList.remove('is-hidden');
        roomOptions.setAttribute('aria-hidden', 'false');
        // make roomType required
        const roomTypeInputs = Array.from(form.elements['roomType'] || []);
        roomTypeInputs.forEach(i => i.required = true);
      }
      function hideRoomOptions() {
        roomOptions.classList.add('is-hidden');
        roomOptions.setAttribute('aria-hidden', 'true');
        const roomTypeInputs = Array.from(form.elements['roomType'] || []);
        roomTypeInputs.forEach(i => i.required = false);
      }

      // initialize
      updateLodgingVisibility();

      attendanceRadios.forEach(r => r.addEventListener('change', updateLodgingVisibility));
      willStayRadios.forEach(r => r.addEventListener('change', function () {
        const val = willStayRadios.find(x => x.checked)?.value;
        if (val === 'si') showRoomOptions(); else hideRoomOptions();
      }));

      // Form submit via fetch to Formspree for custom message
      form.addEventListener('submit', async function (e) {
        e.preventDefault();
        statusEl.innerHTML = '';

        // native validation
        if (!form.checkValidity()) {
          form.reportValidity();
          return;
        }

        const action = form.action;
        const formData = new FormData(form);

        try {
          submitBtn.disabled = true;
          submitBtn.setAttribute('aria-busy', 'true');

          const resp = await fetch(action, {
            method: 'POST',
            body: formData,
            headers: { 'Accept': 'application/json' }
          });

          if (resp.ok) {
            // Show success message under button (animated)
            statusEl.innerHTML = '<div class="rsvp-message" id="rsvpMessage">Gracias, nos vemos el 30 de Mayo.</div>';
            const msg = document.getElementById('rsvpMessage');
            requestAnimationFrame(() => requestAnimationFrame(() => msg.classList.add('show')));
            form.reset();
            // reset visibility after clearing
            updateLodgingVisibility();
            hideRoomOptions();
            // keep submit disabled to avoid duplicate sends
          } else {
            const data = await resp.json().catch(()=>null);
            let msg = 'Error al enviar. Por favor int√©ntalo de nuevo.';
            if (data && data.error) msg = data.error;
            statusEl.innerHTML = '<div class="form-note" style="color: #b33;">'+msg+'</div>';
            submitBtn.disabled = false;
            submitBtn.removeAttribute('aria-busy');
          }
        } catch (err) {
          statusEl.innerHTML = '<div class="form-note" style="color: #b33;">Error de conexi√≥n. Intenta de nuevo m√°s tarde.</div>';
          submitBtn.disabled = false;
          submitBtn.removeAttribute('aria-busy');
        }
      });
    })();
  </script>
</body>
</html>
