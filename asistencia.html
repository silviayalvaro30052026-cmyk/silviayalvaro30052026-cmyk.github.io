<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Asistencia — Silvia & Álvaro</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Confirma tu asistencia a la boda de Silvia & Álvaro." />

  <!-- Misma fuente que el resto del sitio -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&display=swap" rel="stylesheet" />

  <link rel="stylesheet" href="styles.css" />
  <style>
    /* Estilos locales del formulario (complementan styles.css) */
    .rsvp-form { display:block; width:100%; }
    .form-row { display:flex; gap:1rem; margin:0.5rem 0 1rem; align-items:center; flex-wrap:wrap; }
    .form-row .field { flex:1 1 220px; min-width:180px; }
    label { display:block; font-weight:600; margin-bottom:0.35rem; color: inherit; font-family: inherit; }
    input[type="text"], textarea {
      width:100%;
      padding:0.6rem 0.75rem;
      border-radius:8px;
      border:1px solid rgba(0,0,0,0.12);
      background: rgba(255,255,255,0.96);
      font-family: inherit;
      font-size: 1rem;
      color: inherit;
      box-sizing: border-box;
    }
    textarea { min-height: 100px; resize: vertical; }
    fieldset { border: 0; padding: 0; margin: 0 0 1rem 0; }
    .choices, .radio-group { display:flex; gap:0.6rem; flex-wrap:wrap; align-items:center; }
    .choice-label {
      display:inline-flex; align-items:center; gap:0.45rem; padding:0.35rem 0.6rem;
      border-radius:8px; background: rgba(255,255,255,0.72); cursor: pointer; font-weight:600; color: #0b3d2e;
      font-family: inherit;
    }
    input[type="radio"] { accent-color: var(--brand-green); }

    /* Form actions: centrar botón y mensaje debajo */
    .form-actions {
      margin-top: 0.75rem;
      display:flex;
      flex-direction:column;
      gap:0.6rem;
      align-items:center;
      justify-content:center;
    }

    .form-note { font-size:0.95rem; color: rgba(11,61,46,0.8); font-family: inherit; }

    /* Mensaje de confirmación sin caja verde, con animación */
    .rsvp-message {
      opacity: 0;
      transform: translateY(10px);
      transition: opacity 420ms ease, transform 420ms cubic-bezier(.2,.9,.2,1);
      color: var(--brand-green-dark);
      font-weight:700;
      font-family: inherit;
      font-size: 1.05rem;
      text-align:center;
    }
    .rsvp-message.show {
      opacity: 1;
      transform: translateY(0);
    }

    @media (max-width:640px) {
      .form-row { gap:0.5rem; }
      .form-row .field { flex:1 1 100%; min-width:0; }
    }
  </style>
</head>
<body class="evento-page">

  <!-- Navegación en el flujo de la página (no fija) -->
  <nav class="top-nav" role="navigation" aria-label="Navegación de la boda">
    <ul class="nav-list" role="menubar" aria-label="Secciones">
      <li role="none"><a role="menuitem" class="nav-btn" href="index.html">Inicio</a></li>
      <li role="none"><a role="menuitem" class="nav-btn" href="evento.html">Evento</a></li>
      <li role="none"><span class="nav-current" aria-current="page">Asistencia</span></li>
      <li role="none"><a role="menuitem" class="nav-btn" href="alojamiento.html">Alojamiento</a></li>
      <li role="none"><a role="menuitem" class="nav-btn" href="regalo.html">Regalo</a></li>
    </ul>
  </nav>

  <main id="main" class="section" role="main">
    <h1>Confirmar asistencia</h1>

    <section class="card" aria-labelledby="asistencia-heading">
      <h2 id="asistencia-heading" style="margin-top:0;">Formulario de asistencia</h2>

      <!-- FORM: enviado a Formspree vía fetch para mostrar mensaje personalizado -->
      <form id="rsvpForm" class="rsvp-form" method="POST" action="https://formspree.io/f/mdaankgw" novalidate>
        <input type="hidden" name="_subject" value="RSVP Silvia & Álvaro">
        <input type="text" name="_gotcha" style="display:none" aria-hidden="true">

        <!-- 1. ¿Asistirás? (solo Sí / No) -->
        <fieldset aria-labelledby="asistiras-legend">
          <legend id="asistiras-legend" style="font-weight:700;margin-bottom:0.5rem;">¿Asistirás a la boda?</legend>
          <div class="choices" role="radiogroup" aria-labelledby="asistiras-legend">
            <label class="choice-label">
              <input type="radio" name="attendance" value="si" required> Sí
            </label>

            <label class="choice-label">
              <input type="radio" name="attendance" value="no"> No
            </label>
          </div>
        </fieldset>

        <!-- 2. ¿Quién eres? -->
        <fieldset>
          <legend style="font-weight:700;margin-bottom:0.5rem;">¿Quién eres?</legend>
          <div class="form-row">
            <div class="field">
              <label for="firstName">Nombre</label>
              <input id="firstName" name="firstName" type="text" placeholder="Nombre" required>
            </div>
            <div class="field">
              <label for="lastName">Apellido</label>
              <input id="lastName" name="lastName" type="text" placeholder="Apellido" required>
            </div>
          </div>
        </fieldset>

        <!-- 3. Dieta (radios, selección única) -->
        <fieldset>
          <legend style="font-weight:700;margin-bottom:0.5rem;">¿Sigues alguna dieta especial?</legend>
          <div class="radio-group" role="radiogroup" aria-labelledby="dieta-legend" id="dieta-legend">
            <label class="choice-label"><input type="radio" name="diet" value="no" checked> No</label>
            <label class="choice-label"><input type="radio" name="diet" value="vegetariana"> Vegetariana</label>
            <label class="choice-label"><input type="radio" name="diet" value="vegetariana-pescado"> Vegetariana (como pescado)</label>
            <label class="choice-label"><input type="radio" name="diet" value="vegana"> Vegana</label>
          </div>
        </fieldset>

        <!-- 4. Intolerancias / alergias -->
        <fieldset>
          <legend style="font-weight:700;margin-bottom:0.5rem;">¿Alguna intolerancia o alergia?</legend>
          <div class="form-row">
            <div class="field" style="flex:1 1 100%;">
              <label for="allergies" class="form-note">Indica aquí si tienes alguna intolerancia o alergia</label>
              <textarea id="allergies" name="allergies" placeholder="Escribe aquí intolerancias o alergias…"></textarea>
            </div>
          </div>
        </fieldset>

        <!-- 5. Preboda -->
        <fieldset aria-labelledby="preboda-legend">
          <legend id="preboda-legend" style="font-weight:700;margin-bottom:0.5rem;">¿Vendrás a la preboda?</legend>
          <div class="choices" role="radiogroup" aria-labelledby="preboda-legend">
            <label class="choice-label"><input type="radio" name="preboda" value="si"> Sí</label>
            <label class="choice-label"><input type="radio" name="preboda" value="no" checked> No</label>
          </div>
        </fieldset>

        <!-- 6. Algo más que debamos saber -->
        <fieldset>
          <legend style="font-weight:700;margin-bottom:0.5rem;">¿Algo más que debamos saber?</legend>
          <div class="form-row">
            <div class="field" style="flex:1 1 100%;">
              <label for="notes" class="form-note">Comentarios adicionales (transporte, horarios, etc.)</label>
              <textarea id="notes" name="notes" placeholder="Escribe aquí…"></textarea>
            </div>
          </div>
        </fieldset>

        <div class="form-actions">
          <!-- Botón centrado con solo "Enviar" -->
          <button type="submit" class="btn-primary" aria-label="Enviar">Enviar</button>

          <!-- Mensaje aparecerá aquí debajo del botón con efecto -->
          <div id="formStatus" role="status" aria-live="polite"></div>
        </div>
      </form>
    </section>
  </main>

  <footer class="footer" role="contentinfo">Álvaro & Silvia · 30/05/2026</footer>

  <script>
    (function () {
      // Mostrar/ocultar acompañante ya no necesario (campo eliminado)
      // Envío por fetch a Formspree para poder mostrar mensaje personalizado con animación
      const form = document.getElementById('rsvpForm');
      const statusEl = document.getElementById('formStatus');
      const submitBtn = form.querySelector('button[type="submit"]');

      form.addEventListener('submit', async function (e) {
        e.preventDefault();
        statusEl.innerHTML = ''; // limpiar
        if (!form.checkValidity()) {
          form.reportValidity();
          return;
        }

        const action = form.action;
        const formData = new FormData(form);

        try {
          submitBtn.disabled = true;
          submitBtn.setAttribute('aria-busy', 'true');

          const resp = await fetch(action, {
            method: 'POST',
            body: formData,
            headers: { 'Accept': 'application/json' }
          });

          if (resp.ok) {
            // Insertar mensaje sin caja, con animación
            statusEl.innerHTML = '<div class="rsvp-message" id="rsvpMessage">Gracias, nos vemos el 30 de Mayo.</div>';
            // Forzar repaint y añadir clase "show" para activar la transición
            const msg = document.getElementById('rsvpMessage');
            requestAnimationFrame(() => requestAnimationFrame(() => msg.classList.add('show')));
            form.reset();
            // mantener botón deshabilitado para evitar envíos repetidos; si quieres reactivar lo podemos hacer tras X segundos
          } else {
            const data = await resp.json().catch(()=>null);
            let msg = 'Error al enviar. Por favor inténtalo de nuevo.';
            if (data && data.error) msg = data.error;
            statusEl.innerHTML = '<div class="form-note" style="color:#b33">'+msg+'</div>';
            submitBtn.disabled = false;
            submitBtn.removeAttribute('aria-busy');
          }
        } catch (err) {
          statusEl.innerHTML = '<div class="form-note" style="color:#b33">Error de conexión. Intenta de nuevo más tarde.</div>';
          submitBtn.disabled = false;
          submitBtn.removeAttribute('aria-busy');
        }
      });
    })();
  </script>
</body>
</html>
